(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();var _=(e=>(e.Functional="Functional",e.TextOnly="TextOnly",e.Maintenance="Maintenance",e.Playground="Playground",e.DirectPlayback="DirectPlayback",e))(_||{}),A=(e=>(e.Embed="embed",e.Query="query",e.Partial="partial",e.Answer="answer",e.Complete="done",e))(A||{}),H=(e=>(e.Clip="clip",e.Talk="talk",e))(H||{}),x=(e=>(e.Start="START",e.Stop="STOP",e))(x||{}),U=(e=>(e.ChatAnswer="chat/answer",e.ChatPartial="chat/partial",e.StreamDone="stream/done",e.StreamStarted="stream/started",e.StreamFailed="stream/error",e.StreamReady="stream/ready",e.StreamCreated="stream/created",e.StreamVideoCreated="stream-video/started",e.StreamVideoDone="stream-video/done",e.StreamVideoError="stream-video/error",e.StreamVideoRejected="stream-video/rejected",e))(U||{}),b=(e=>(e.New="new",e.Fail="fail",e.Connected="connected",e.Connecting="connecting",e.Closed="closed",e.Completed="completed",e.Disconnected="disconnected",e))(b||{});const J="https://api.d-id.com",ge="wss://notifications.d-id.com",me="79f81a83a67430be2bc0fd61042b8faa",B=()=>Math.random().toString(16).slice(2);function ie(){let e=window.localStorage.getItem("did_external_key_id");return e||(e=Math.random().toString(16).slice(2),window.localStorage.setItem("did_external_key_id",e)),e}let he=B();function se(e){if(e.type==="bearer")return`Bearer ${e.token}`;if(e.type==="basic")return`Basic ${btoa(`${e.username}:${e.password}`)}`;if(e.type==="key")return`Client-Key ${e.clientKey}.${ie()}_${he}`;throw new Error(`Unknown auth type: ${e}`)}function ee(e,n=J,s){const o=async(r,a)=>{const i=await fetch(n+(r!=null&&r.startsWith("/")?r:`/${r}`),{...a,headers:{...a==null?void 0:a.headers,Authorization:se(e),"Content-Type":"application/json"}});if(!i.ok){let t=await i.text().catch(()=>"Failed to fetch");throw s&&s(new Error(t),{url:r,options:a,headers:i.headers}),new Error(t)}return i.json()};return{get(r,a){return o(r,{...a,method:"GET"})},post(r,a,i){return o(r,{...i,body:JSON.stringify(a),method:"POST"})},delete(r,a,i){return o(r,{...i,body:JSON.stringify(a),method:"DELETE"})},patch(r,a,i){return o(r,{...i,body:JSON.stringify(a),method:"PATCH"})}}}function pe(e,n=J,s){const o=ee(e,`${n}/agents`,s);return{create(r,a){return o.post("/",r,a)},getAgents(r,a){return o.get(`/${r?`?tag=${r}`:""}`,a).then(i=>i??[])},getById(r,a){return o.get(`/${r}`,a)},delete(r,a){return o.delete(`/${r}`,void 0,a)},update(r,a,i){return o.patch(`/${r}`,a,i)},newChat(r,a){return o.post(`/${r}/chat`,void 0,a)},chat(r,a,i,t){return o.post(`/${r}/chat/${a}`,i,t)},createRating(r,a,i,t){return o.post(`/${r}/chat/${a}/ratings`,i,t)},updateRating(r,a,i,t,d){return o.patch(`/${r}/chat/${a}/ratings/${i}`,t,d)},deleteRating(r,a,i,t){return o.delete(`/${r}/chat/${a}/ratings/${i}`,t)}}}const we=e=>new Promise(n=>setTimeout(n,e));function ve(e){return new Promise((n,s)=>{const{callbacks:o,host:r,auth:a}=e,{onMessage:i=null,onOpen:t=null,onClose:d=null,onError:w=null}=o||{},y=new WebSocket(`${r}?authorization=${se(a)}`);y.onmessage=i,y.onclose=d,y.onerror=v=>{console.error(v),w==null||w("Websocket failed to connect",v),s(v)},y.onopen=v=>{t==null||t(v),n(y)}})}async function fe(e){const{retries:n=1}=e;let s=null;for(let o=0;(s==null?void 0:s.readyState)!==WebSocket.OPEN;o++)try{s=await ve(e)}catch(r){if(o===n)throw r;await we(o*500)}return s}async function ye(e,n,s){const o=s!=null&&s.onMessage?[s.onMessage]:[],r=await fe({auth:e,host:n,callbacks:{onError:s==null?void 0:s.onError,onMessage:a=>{const i=JSON.parse(a.data);o.forEach(t=>t(i.event,i))}}});return{socket:r,disconnect:()=>r.close(),subscribeToEvents:a=>o.push(a)}}const Se="X-Playground-Chat";function be(e,n,s,o){const r=ee(e,`${n}/agents/${s}`,o);return{createStream(a){return r.post("/streams",{compatibility_mode:a.compatibility_mode,stream_warmup:a.stream_warmup,session_timeout:a.session_timeout})},startConnection(a,i,t){return r.post(`/streams/${a}/sdp`,{session_id:t,answer:i})},addIceCandidate(a,i,t){return r.post(`/streams/${a}/ice`,{session_id:t,...i})},sendStreamRequest(a,i,t){return r.post(`/streams/${a}`,{session_id:i,...t})},close(a,i){return r.delete(`/streams/${a}`,{session_id:i})}}}function Me(e,n,s,o){const r=ee(e,`${n}/agents/${s}`,o);return{createStream(a,i){return r.post("/streams",{driver_url:a.driver_url,face:a.face,config:a.config,compatibility_mode:a.compatibility_mode,stream_warmup:a.stream_warmup,output_resolution:a.output_resolution,session_timeout:a.session_timeout},i)},startConnection(a,i,t,d){return r.post(`/streams/${a}/sdp`,{session_id:t,answer:i},d)},addIceCandidate(a,i,t,d){return r.post(`/streams/${a}/ice`,{session_id:t,...i},d)},sendStreamRequest(a,i,t,d){return r.post(`/streams/${a}`,{session_id:i,...t},d)},close(a,i,t){return r.delete(`/streams/${a}`,{session_id:i},t)}}}let ce=!1;const O=(e,n)=>ce&&console.log(e,n),ke=(window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection).bind(window);function ne(e){switch(e){case"connected":return b.Connected;case"checking":return b.Connecting;case"failed":return b.Fail;case"new":return b.New;case"closed":return b.Closed;case"disconnected":return b.Disconnected;case"completed":return b.Completed;default:return b.New}}function Ce(){let e=0;return n=>{for(const s of n.values())if(s&&s.type==="inbound-rtp"&&s.kind==="video"){const o=s.bytesReceived,r=o-e>0;return e=o,r}return!1}}function _e(e,n){const s=Math.max(Math.ceil(10),1);let o=0,r=!1;const a=Ce();return setInterval(async()=>{const i=await e.getStats();a(i)?(o=0,r||(n==null||n(x.Start),r=!0)):r&&(o++,o>=s&&(n==null||n(x.Stop),r=!1))},100)}async function Ee(e,n,{debug:s=!1,callbacks:o,auth:r,baseURL:a=J,warmup:i}){ce=s;let t;const{startConnection:d,sendStreamRequest:w,close:y,createStream:v,addIceCandidate:m}=n.videoType===H.Clip?be(r,a,e,o.onError):Me(r,a,e,o.onError),{id:h,offer:X,ice_servers:V,session_id:k}=await v(n),f=new ke({iceServers:V}),c=f.createDataChannel("JanusDataChannel");if(!k)throw new Error("Could not create session_id");const u=_e(f,o.onVideoStateChange);f.onicecandidate=l=>{O("peerConnection.onicecandidate",l),l.candidate&&l.candidate.sdpMid&&l.candidate.sdpMLineIndex!==null?m(h,{candidate:l.candidate.candidate,sdpMid:l.candidate.sdpMid,sdpMLineIndex:l.candidate.sdpMLineIndex},k):m(h,{candidate:null},k)},f.oniceconnectionstatechange=()=>{var l;O("peerConnection.oniceconnectionstatechange => "+f.iceConnectionState);const g=ne(f.iceConnectionState);g===b.Connected?t=setTimeout(()=>{var S;return(S=o.onConnectionStateChange)==null?void 0:S.call(o,b.Connected)},i?5e3:0):(clearTimeout(t),(l=o.onConnectionStateChange)==null||l.call(o,g))},f.ontrack=l=>{var g;O("peerConnection.ontrack",l),(g=o.onSrcObjectReady)==null||g.call(o,l.streams[0])},c.onmessage=l=>{var g;if(c.readyState==="open"){const[S,C]=l.data.split(":");S===U.StreamReady&&(clearTimeout(t),(g=o.onConnectionStateChange)==null||g.call(o,b.Connected))}},await f.setRemoteDescription(X),O("set remote description OK");const p=await f.createAnswer();return O("create answer OK"),await f.setLocalDescription(p),O("set local description OK"),await d(h,p,k),O("start connection OK"),{speak(l){return w(h,k,l)},async disconnect(){var l,g;if(h){const S=ne(f.iceConnectionState);if(f){if(S===b.New){(l=o.onVideoStateChange)==null||l.call(o,x.Stop),clearInterval(u);return}f.close(),f.oniceconnectionstatechange=null,f.onnegotiationneeded=null,f.onicecandidate=null,f.ontrack=null}try{S===b.Connected&&await y(h,k).catch(C=>{})}catch(C){O("Error on close stream connection",C)}(g=o.onVideoStateChange)==null||g.call(o,x.Stop),clearInterval(u)}},sessionId:k,streamId:h}}let Q={};function $e(e){const n=window!=null&&window.hasOwnProperty("DID_AGENTS_API")?"agents-ui":"agents-sdk",s={token:e.token||"testKey",distinct_id:e.distinctId||ie(),agentId:e.agent.id,agentType:e.agent.presenter.type,owner_id:e.agent.owner_id??""};return{...s,isEnabled:e.isEnabled??!0,getRandom:()=>Math.random().toString(16).slice(2),track(o,r){if(!this.isEnabled)return Promise.reject("MixPanel analytics is disabled on creation");const{audioPath:a,...i}=r||{},t={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({data:JSON.stringify([{event:o,properties:{...i,...s,source:n,time:Date.now(),$insert_id:this.getRandom(),origin:window.location.href,"Screen Height":window.screen.height||window.innerWidth,"Screen Width":window.screen.width||window.innerHeight,"User Agent":navigator.userAgent}}])})};return fetch("https://api-js.mixpanel.com/track/?verbose=1&ip=1",t).then(d=>d.json()).catch(d=>console.error(d))},linkTrack(o,r,a,i){Q[o]||(Q[o]={events:{},resolvedDependencies:[]}),i.includes(a)||i.push(a);const t=Q[o];if(t.events[a]={props:r},t.resolvedDependencies.push(a),i.every(d=>t.resolvedDependencies.includes(d))){const d=i.reduce((w,y)=>t.events[y]?{...w,...t.events[y].props}:w,{});this.track(o,d),t.resolvedDependencies=t.resolvedDependencies.filter(w=>!i.includes(w)),i.forEach(w=>{delete t.events[w]})}}}}function Te(e){var n,s,o,r,a;const i=()=>/Mobi|Android/i.test(navigator.userAgent)?"Mobile":"Desktop";return{$os:`${(()=>{const t=navigator.platform;return t.toLowerCase().includes("win")?"Windows":t.toLowerCase().includes("mac")?"Mac OS X":t.toLowerCase().includes("linux")?"Linux":"Unknown"})()}`,isMobile:`${i()=="Mobile"}`,browser:navigator.userAgent,origin:window.location.origin,agentType:(n=e.presenter)==null?void 0:n.type,agentVoice:{voiceId:(o=(s=e.presenter)==null?void 0:s.voice)==null?void 0:o.voice_id,provider:(a=(r=e.presenter)==null?void 0:r.voice)==null?void 0:a.type}}}function Ie(e,n,s){var o,r;const{event:a,...i}=e,{template:t}=(n==null?void 0:n.llm)||{},{language:d}=((o=n==null?void 0:n.presenter)==null?void 0:o.voice)||{},{stitch:w}=(n==null?void 0:n.presenter)||{};return{...i,llm:{...i.llm,template:t},script:{...i.script,provider:{...(r=i==null?void 0:i.script)==null?void 0:r.provider,language:d}},stitch:w,...s}}let R=0;function Oe(e,n){var s,o,r,a,i,t,d;return e.presenter.type===H.Clip?{videoType:H.Clip,session_timeout:(s=n==null?void 0:n.streamOptions)==null?void 0:s.sessionTimeout,stream_warmup:(o=n==null?void 0:n.streamOptions)==null?void 0:o.streamWarmup,compatibility_mode:(r=n==null?void 0:n.streamOptions)==null?void 0:r.compatibilityMode}:{videoType:H.Talk,session_timeout:(a=n==null?void 0:n.streamOptions)==null?void 0:a.sessionTimeout,stream_warmup:(i=n==null?void 0:n.streamOptions)==null?void 0:i.streamWarmup,compatibility_mode:(t=n==null?void 0:n.streamOptions)==null?void 0:t.compatibilityMode,output_resolution:(d=n==null?void 0:n.streamOptions)==null?void 0:d.outputResolution}}function le(e){return e===_.Playground?{headers:{[Se]:"true"}}:{}}async function de(e,n,s,o){try{const r=await n.newChat(e,le(o));return s.track("agent-chat",{event:"created",chat_id:r.id,agent_id:e,mode:o}),r}catch(r){try{console.error(r);const a=JSON.parse(r.message);if((a==null?void 0:a.kind)==="InsufficientCreditsError")throw new Error("InsufficientCreditsError")}catch(a){console.error("Error parsing the error message:",a)}throw new Error("Cannot create new chat")}}function Pe(e,n,s,o,r){return new Promise(async(a,i)=>{var t;R=0;const d=await Ee(e.id,Oe(e,n),{...n,analytics:o,warmup:(t=n.streamOptions)==null?void 0:t.streamWarmup,callbacks:{...n.callbacks,onConnectionStateChange:async w=>{var y,v;w===b.Connected&&(!r&&n.mode!==_.DirectPlayback&&(r=await de(e.id,s,o,n.mode).catch(m=>{i(m)})),d?a({chat:r,streamingManager:d}):r&&i(new Error("Something went wrong while initializing the manager"))),(v=(y=n.callbacks).onConnectionStateChange)==null||v.call(y,w)},onVideoStateChange(w){var y,v;(v=(y=n.callbacks).onVideoStateChange)==null||v.call(y,w),R>0&&w===x.Start&&o.linkTrack("agent-video",{event:"start",latency:Date.now()-R},"start",[U.StreamVideoCreated])}}}).catch(i)})}function ae(e){let n="";if(e.greetings&&e.greetings.length>0){const s=Math.floor(Math.random()*e.greetings.length);n=e.greetings[s]}else n=`Hi! I'm ${e.preview_name||"My Agent"}. How can I help you?`;return[{content:n,id:B(),role:"assistant",created_at:new Date().toISOString()}]}function Le(e){if(e.answer!==void 0)return e.answer;let n=0,s="";for(;n in e;)s+=e[n],n++;return s}function De(e,n,s,o,r){if(!(e===A.Partial||e===A.Answer))return;const a=o.messages[o.messages.length-1];if((a==null?void 0:a.role)!=="assistant")return;const{content:i,sequence:t}=n;e===A.Partial?s[t]=i:s.answer=i;const d=Le(s);(a.content!==d||e===A.Answer)&&(a.content=d,r==null||r([...o.messages],e))}async function Re(e,n){var s,o,r;let a={},i=!0;const t={messages:[],chatMode:n.mode||_.Functional},d=n.baseURL||J,w=n.wsURL||ge,y=n.mixpanelKey||me,v=pe(n.auth,d,n.callbacks.onError),m=await v.getById(e);t.messages=ae(m),(o=(s=n.callbacks).onNewMessage)==null||o.call(s,[...t.messages],"answer");const h=$e({token:y,agent:m,...n});h.track("agent-sdk",{event:"loaded",...Te(m)});const X={onMessage:(c,u)=>{var p,l;if("content"in u)De(c,u,a,t,n.callbacks.onNewMessage),c===A.Answer&&h.track("agent-message-received",{messages:t.messages.length,mode:t.chatMode});else{const g=U,S=[g.StreamVideoDone,g.StreamVideoError,g.StreamVideoRejected],C=[g.StreamFailed,g.StreamVideoError,g.StreamVideoRejected],E=Ie(u,m,{mode:t.chatMode});if(c=c,c===g.StreamVideoCreated)h.linkTrack("agent-video",E,g.StreamVideoCreated,["start"]);else if(S.includes(c)){const M=c.split("/")[1];h.track("agent-video",{...E,event:M})}C.includes(c)&&((l=(p=n.callbacks).onError)==null||l.call(p,new Error(`Stream failed with event ${c}`),{data:u})),u.event===g.StreamDone&&k()}}};async function V(c){var u,p,l,g,S;R=0,c&&!i&&(delete t.chat,t.messages=ae(m),(p=(u=n.callbacks).onNewMessage)==null||p.call(u,[...t.messages],"answer"));const C=n.mode===_.DirectPlayback?Promise.resolve(void 0):ye(n.auth,w,X),E=Pe(m,n,v,h,t.chat).catch(L=>{throw f(_.Maintenance),L}),[M,{streamingManager:I,chat:T}]=await Promise.all([C,E]);T&&T.id!==((l=t.chat)==null?void 0:l.id)&&((S=(g=n.callbacks).onNewChat)==null||S.call(g,T.id)),t.streamingManager=I,t.socketManager=M,t.chat=T,i=!1,f((T==null?void 0:T.chat_mode)??n.mode??_.Functional)}async function k(){var c,u,p,l;(c=t.socketManager)==null||c.disconnect(),await((u=t.streamingManager)==null?void 0:u.disconnect()),delete t.streamingManager,delete t.socketManager,(l=(p=n.callbacks).onConnectionStateChange)==null||l.call(p,b.Disconnected)}async function f(c){var u,p;c!==t.chatMode&&(h.track("agent-mode-change",{mode:c}),t.chatMode=c,t.chatMode!==_.Functional&&await k(),(p=(u=n.callbacks).onModeChange)==null||p.call(u,c))}return{agent:m,starterMessages:((r=m.knowledge)==null?void 0:r.starter_message)||[],changeMode:f,async connect(){var c;await V(!0),h.track("agent-chat",{event:"connect",chatId:(c=t.chat)==null?void 0:c.id,agentId:m.id,mode:t.chatMode})},async reconnect(){var c;await k(),await V(!1),h.track("agent-chat",{event:"reconnect",chatId:(c=t.chat)==null?void 0:c.id,agentId:m.id,mode:t.chatMode})},async disconnect(){var c;await k(),h.track("agent-chat",{event:"disconnect",chatId:(c=t.chat)==null?void 0:c.id,agentId:m.id,mode:t.chatMode})},async chat(c){var u,p,l,g,S,C;const E=B();a={};try{if(R=Date.now(),n.mode===_.DirectPlayback)throw new Error("Direct playback is enabled, chat is disabled");if(c.length>=800)throw new Error("Message cannot be more than 800 characters");if(c.length===0)throw new Error("Message cannot be empty");if(t.chatMode===_.Maintenance)throw new Error("Chat is in maintenance mode");if(![_.TextOnly,_.Playground].includes(t.chatMode))if(t.streamingManager){if(!t.chat)throw new Error("Chat is not initialized")}else throw new Error("Streaming manager is not initialized");t.messages.push({id:B(),role:"user",content:c,created_at:new Date(R).toISOString()}),(p=(u=n.callbacks).onNewMessage)==null||p.call(u,[...t.messages],"user"),t.chat||(t.chat=await de(m.id,v,h,t.chatMode),(g=(l=n.callbacks).onNewChat)==null||g.call(l,t.chat.id));const M={id:E,role:"assistant",content:"",created_at:new Date().toISOString(),matches:[]},I=[...t.messages];t.messages.push(M);const T=j=>{var q,te;return v.chat(m.id,j,{sessionId:(q=t.streamingManager)==null?void 0:q.sessionId,streamId:(te=t.streamingManager)==null?void 0:te.streamId,chatMode:t.chatMode,messages:I},le(t.chatMode))},L=await T(t.chat.id).catch(async j=>{var q;if(!((q=j==null?void 0:j.message)!=null&&q.includes("missing or invalid session_id")))throw j;return await k(),await V(!1),T(t.chat.id)});return h.track("agent-message-send",{event:"success",mode:t.chatMode,messages:t.messages.length+1}),M.context=L.context,M.matches=L.matches,L.result&&(M.content=L.result,h.track("agent-message-received",{latency:Date.now()-R,mode:t.chatMode,messages:t.messages.length}),(C=(S=n.callbacks).onNewMessage)==null||C.call(S,[...t.messages],"answer")),L}catch(M){throw t.messages[t.messages.length-1].id===E&&t.messages.pop(),h.track("agent-message-send",{event:"error",mode:t.chatMode,messages:t.messages.length}),M}},rate(c,u,p){var l,g,S,C;const E=t.messages.find(I=>I.id===c);if(t.chat){if(!E)throw new Error("Message not found")}else throw new Error("Chat is not initialized");const M=((l=E.matches)==null?void 0:l.map(I=>[I.document_id,I.id]))??[];return h.track("agent-rate",{event:p?"update":"create",thumb:u===1?"up":"down",knowledge_id:((g=m.knowledge)==null?void 0:g.id)??"",mode:t.chatMode,matches:M,score:u}),p?v.updateRating(m.id,t.chat.id,p,{knowledge_id:((S=m.knowledge)==null?void 0:S.id)??"",message_id:c,matches:M,score:u}):v.createRating(m.id,t.chat.id,{knowledge_id:((C=m.knowledge)==null?void 0:C.id)??"",message_id:c,matches:M,score:u})},deleteRate(c){var u;if(!t.chat)throw new Error("Chat is not initialized");return h.track("agent-rate-delete",{type:"text",chat_id:(u=t.chat)==null?void 0:u.id,id:c,mode:t.chatMode}),v.deleteRating(m.id,t.chat.id,c)},speak(c){if(!t.streamingManager)throw new Error("Please connect to the agent first");function u(){if(typeof c=="string"){if(!m.presenter.voice)throw new Error("Presenter voice is not initialized");return{type:"text",provider:m.presenter.voice,input:c,ssml:!1}}if(c.type==="text"&&!c.provider){if(!m.presenter.voice)throw new Error("Presenter voice is not initialized");return{type:"text",provider:m.presenter.voice,input:c.input,ssml:c.ssml}}return c}const p=u();return h.track("agent-speak",p),t.streamingManager.speak({script:p})}}}let Ae="agt_twx-LK32",ue={type:"key",clientKey:"Z29vZ2xlLW9hdXRoMnwxMDI5MDQ4NjI1NzIzMzU1MjQyOTM6WEFnN2Z5SUVPN3dTeU5yREEyVXg3"},D=document.querySelector("#videoElement"),N=document.querySelector("#textArea"),G=document.querySelector("#langSelect"),z=document.querySelector("#speechButton"),K=document.querySelector("#answers"),P=document.querySelector("#connectionLabel"),F=document.getElementById("chatButton"),W=document.getElementById("speakButton"),xe=document.querySelector("#reconnectButton"),Z,$;const Ne={onSrcObjectReady(e){return console.log("onSrcObjectReady():",e),D.srcObject=e,Z=e,Z},onConnectionStateChange(e){console.log("onConnectionStateChange(): ",e),e=="connecting"?(P.innerHTML="Connecting..",document.querySelector("#container").style.display="flex",document.querySelector("#hidden").style.display="none"):e=="connected"?(N.addEventListener("keypress",n=>{n.key==="Enter"&&(n.preventDefault(),Y())}),F.removeAttribute("disabled"),W.removeAttribute("disabled"),G.removeAttribute("disabled"),z.removeAttribute("disabled"),P.innerHTML="Online"):(e=="disconnected"||e=="closed")&&(N.removeEventListener("keypress",n=>{n.key==="Enter"&&(n.preventDefault(),Y())}),document.querySelector("#hidden_h2").innerHTML=`${$.agent.preview_name} Disconnected`,document.querySelector("#hidden").style.display="block",document.querySelector("#container").style.display="none",F.setAttribute("disabled",!0),W.setAttribute("disabled",!0),G.setAttribute("disabled",!0),z.setAttribute("disabled",!0),P.innerHTML="")},onVideoStateChange(e){console.log("onVideoStateChange(): ",e),e=="STOP"?(D.muted=!0,D.srcObject=void 0,D.src=$.agent.presenter.idle_video):(D.muted=!1,D.src="",D.srcObject=Z,P.innerHTML="Online")},onNewMessage(e,n){console.log("onNewMessage():",e,n);let s=e.length-1,o=e[s];o.role=="assistant"&&e.length!=1?n=="answer"&&(K.innerHTML+=`${oe()} - [${o.role}] : ${o.content}  <button id='${o.id}_plus' title='agentManager.rate() -> Rate this answer (+)'>+</button> <button id='${o.id}_minus' title='agentManager.rate() -> Rate this answer (-)'>-</button> <br>`,document.getElementById(`${o.id}_plus`).addEventListener("click",()=>re(o.id,1)),document.getElementById(`${o.id}_minus`).addEventListener("click",()=>re(o.id,-1))):K.innerHTML+=`${oe()} - [${o.role}] : ${o.content}  <br>`,K.scrollTop=K.scrollHeight},onError(e,n){P.innerHTML='<span style="color:red">Something went wrong :(</span>',console.log("Error:",e,"Error Data",n)}};let Ve={compatibilityMode:"auto",streamWarmup:!0};function je(){let e=N.value;e!==""&&e.length>2&&($.speak({type:"text",input:e}),console.log(`agentManager.speak("${e}")`),P.innerHTML="Streaming..")}function Y(){let e=N.value;e!==""&&($.chat(e),console.log("agentManager.chat()"),P.innerHTML="Thinking..",N.value="")}function re(e,n){let s=$.rate(e,n);console.log(`Message ID: ${e} Rated:${n}
`,"Result",s)}function qe(){console.log("clicked");let e=$.reconnect();console.log("agentManager.reconnect()",e)}function oe(){const e=new Date,n=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),o=e.getSeconds().toString().padStart(2,"0");return`${n}:${s}:${o}`}ue.clientKey==""&&(P.innerHTML="<span style='color:red; font-weight:bold'> Missing agentID and auth.clientKey variables</span>",console.error("Missing agentID and auth.clientKey variables"),console.log(`Missing agentID and auth.clientKey variables:

Fetch the data-client-key and the data-agent-id as explained on the Agents SDK Overview Page:
https://docs.d-id.com/reference/agents-sdk-overview

Paste these into their respective variables at the top of the main.js file and save.`));F.addEventListener("click",()=>Y());W.addEventListener("click",()=>je());xe.addEventListener("click",()=>qe());z.addEventListener("click",()=>toggleStartStop());window.addEventListener("load",()=>{N.focus(),F.setAttribute("disabled",!0),W.setAttribute("disabled",!0),G.setAttribute("disabled",!0),z.setAttribute("disabled",!0)});const He=()=>new Promise((e,n)=>{try{let s=Re(Ae,{auth:ue,callbacks:Ne,streamOptions:Ve});return e(s)}catch(s){n(s)}}),Ke=async()=>{$=await He(),console.log("sdk.createAgentManager()",$),document.querySelector("#previewName").innerHTML=$.agent.preview_name,console.log("agentManager.connect()"),$.connect()};Ke();
