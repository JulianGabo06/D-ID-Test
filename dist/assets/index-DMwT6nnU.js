(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();var _=(e=>(e.Functional="Functional",e.TextOnly="TextOnly",e.Maintenance="Maintenance",e.Playground="Playground",e.DirectPlayback="DirectPlayback",e))(_||{}),x=(e=>(e.Embed="embed",e.Query="query",e.Partial="partial",e.Answer="answer",e.Complete="done",e))(x||{}),B=(e=>(e.Clip="clip",e.Talk="talk",e))(B||{}),N=(e=>(e.Start="START",e.Stop="STOP",e))(N||{}),X=(e=>(e.ChatAnswer="chat/answer",e.ChatPartial="chat/partial",e.StreamDone="stream/done",e.StreamStarted="stream/started",e.StreamFailed="stream/error",e.StreamReady="stream/ready",e.StreamCreated="stream/created",e.StreamVideoCreated="stream-video/started",e.StreamVideoDone="stream-video/done",e.StreamVideoError="stream-video/error",e.StreamVideoRejected="stream-video/rejected",e))(X||{}),S=(e=>(e.New="new",e.Fail="fail",e.Connected="connected",e.Connecting="connecting",e.Closed="closed",e.Completed="completed",e.Disconnected="disconnected",e))(S||{});const Q="https://api.d-id.com",he="wss://notifications.d-id.com",pe="79f81a83a67430be2bc0fd61042b8faa",U=()=>Math.random().toString(16).slice(2);function ce(){let e=window.localStorage.getItem("did_external_key_id");return e||(e=Math.random().toString(16).slice(2),window.localStorage.setItem("did_external_key_id",e)),e}let we=U();function le(e){if(e.type==="bearer")return`Bearer ${e.token}`;if(e.type==="basic")return`Basic ${btoa(`${e.username}:${e.password}`)}`;if(e.type==="key")return`Client-Key ${e.clientKey}.${ce()}_${we}`;throw new Error(`Unknown auth type: ${e}`)}function te(e,t=Q,s){const o=async(r,a)=>{const i=await fetch(t+(r!=null&&r.startsWith("/")?r:`/${r}`),{...a,headers:{...a==null?void 0:a.headers,Authorization:le(e),"Content-Type":"application/json"}});if(!i.ok){let n=await i.text().catch(()=>"Failed to fetch");throw s&&s(new Error(n),{url:r,options:a,headers:i.headers}),new Error(n)}return i.json()};return{get(r,a){return o(r,{...a,method:"GET"})},post(r,a,i){return o(r,{...i,body:JSON.stringify(a),method:"POST"})},delete(r,a,i){return o(r,{...i,body:JSON.stringify(a),method:"DELETE"})},patch(r,a,i){return o(r,{...i,body:JSON.stringify(a),method:"PATCH"})}}}function ve(e,t=Q,s){const o=te(e,`${t}/agents`,s);return{create(r,a){return o.post("/",r,a)},getAgents(r,a){return o.get(`/${r?`?tag=${r}`:""}`,a).then(i=>i??[])},getById(r,a){return o.get(`/${r}`,a)},delete(r,a){return o.delete(`/${r}`,void 0,a)},update(r,a,i){return o.patch(`/${r}`,a,i)},newChat(r,a){return o.post(`/${r}/chat`,void 0,a)},chat(r,a,i,n){return o.post(`/${r}/chat/${a}`,i,n)},createRating(r,a,i,n){return o.post(`/${r}/chat/${a}/ratings`,i,n)},updateRating(r,a,i,n,d){return o.patch(`/${r}/chat/${a}/ratings/${i}`,n,d)},deleteRating(r,a,i,n){return o.delete(`/${r}/chat/${a}/ratings/${i}`,n)}}}const fe=e=>new Promise(t=>setTimeout(t,e));function ye(e){return new Promise((t,s)=>{const{callbacks:o,host:r,auth:a}=e,{onMessage:i=null,onOpen:n=null,onClose:d=null,onError:w=null}=o||{},y=new WebSocket(`${r}?authorization=${le(a)}`);y.onmessage=i,y.onclose=d,y.onerror=v=>{console.error(v),w==null||w("Websocket failed to connect",v),s(v)},y.onopen=v=>{n==null||n(v),t(y)}})}async function be(e){const{retries:t=1}=e;let s=null;for(let o=0;(s==null?void 0:s.readyState)!==WebSocket.OPEN;o++)try{s=await ye(e)}catch(r){if(o===t)throw r;await fe(o*500)}return s}async function Se(e,t,s){const o=s!=null&&s.onMessage?[s.onMessage]:[],r=await be({auth:e,host:t,callbacks:{onError:s==null?void 0:s.onError,onMessage:a=>{const i=JSON.parse(a.data);o.forEach(n=>n(i.event,i))}}});return{socket:r,disconnect:()=>r.close(),subscribeToEvents:a=>o.push(a)}}const Me="X-Playground-Chat";function ke(e,t,s,o){const r=te(e,`${t}/agents/${s}`,o);return{createStream(a){return r.post("/streams",{compatibility_mode:a.compatibility_mode,stream_warmup:a.stream_warmup,session_timeout:a.session_timeout})},startConnection(a,i,n){return r.post(`/streams/${a}/sdp`,{session_id:n,answer:i})},addIceCandidate(a,i,n){return r.post(`/streams/${a}/ice`,{session_id:n,...i})},sendStreamRequest(a,i,n){return r.post(`/streams/${a}`,{session_id:i,...n})},close(a,i){return r.delete(`/streams/${a}`,{session_id:i})}}}function Ce(e,t,s,o){const r=te(e,`${t}/agents/${s}`,o);return{createStream(a,i){return r.post("/streams",{driver_url:a.driver_url,face:a.face,config:a.config,compatibility_mode:a.compatibility_mode,stream_warmup:a.stream_warmup,output_resolution:a.output_resolution,session_timeout:a.session_timeout},i)},startConnection(a,i,n,d){return r.post(`/streams/${a}/sdp`,{session_id:n,answer:i},d)},addIceCandidate(a,i,n,d){return r.post(`/streams/${a}/ice`,{session_id:n,...i},d)},sendStreamRequest(a,i,n,d){return r.post(`/streams/${a}`,{session_id:i,...n},d)},close(a,i,n){return r.delete(`/streams/${a}`,{session_id:i},n)}}}let de=!1;const O=(e,t)=>de&&console.log(e,t),_e=(window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection).bind(window);function re(e){switch(e){case"connected":return S.Connected;case"checking":return S.Connecting;case"failed":return S.Fail;case"new":return S.New;case"closed":return S.Closed;case"disconnected":return S.Disconnected;case"completed":return S.Completed;default:return S.New}}function Ee(){let e=0;return t=>{for(const s of t.values())if(s&&s.type==="inbound-rtp"&&s.kind==="video"){const o=s.bytesReceived,r=o-e>0;return e=o,r}return!1}}function $e(e,t){const s=Math.max(Math.ceil(10),1);let o=0,r=!1;const a=Ee();return setInterval(async()=>{const i=await e.getStats();a(i)?(o=0,r||(t==null||t(N.Start),r=!0)):r&&(o++,o>=s&&(t==null||t(N.Stop),r=!1))},100)}async function Te(e,t,{debug:s=!1,callbacks:o,auth:r,baseURL:a=Q,warmup:i}){de=s;let n;const{startConnection:d,sendStreamRequest:w,close:y,createStream:v,addIceCandidate:m}=t.videoType===B.Clip?ke(r,a,e,o.onError):Ce(r,a,e,o.onError),{id:h,offer:Z,ice_servers:j,session_id:k}=await v(t),f=new _e({iceServers:j}),c=f.createDataChannel("JanusDataChannel");if(!k)throw new Error("Could not create session_id");const u=$e(f,o.onVideoStateChange);f.onicecandidate=l=>{O("peerConnection.onicecandidate",l),l.candidate&&l.candidate.sdpMid&&l.candidate.sdpMLineIndex!==null?m(h,{candidate:l.candidate.candidate,sdpMid:l.candidate.sdpMid,sdpMLineIndex:l.candidate.sdpMLineIndex},k):m(h,{candidate:null},k)},f.oniceconnectionstatechange=()=>{var l;O("peerConnection.oniceconnectionstatechange => "+f.iceConnectionState);const g=re(f.iceConnectionState);g===S.Connected?n=setTimeout(()=>{var b;return(b=o.onConnectionStateChange)==null?void 0:b.call(o,S.Connected)},i?5e3:0):(clearTimeout(n),(l=o.onConnectionStateChange)==null||l.call(o,g))},f.ontrack=l=>{var g;O("peerConnection.ontrack",l),(g=o.onSrcObjectReady)==null||g.call(o,l.streams[0])},c.onmessage=l=>{var g;if(c.readyState==="open"){const[b,C]=l.data.split(":");b===X.StreamReady&&(clearTimeout(n),(g=o.onConnectionStateChange)==null||g.call(o,S.Connected))}},await f.setRemoteDescription(Z),O("set remote description OK");const p=await f.createAnswer();return O("create answer OK"),await f.setLocalDescription(p),O("set local description OK"),await d(h,p,k),O("start connection OK"),{speak(l){return w(h,k,l)},async disconnect(){var l,g;if(h){const b=re(f.iceConnectionState);if(f){if(b===S.New){(l=o.onVideoStateChange)==null||l.call(o,N.Stop),clearInterval(u);return}f.close(),f.oniceconnectionstatechange=null,f.onnegotiationneeded=null,f.onicecandidate=null,f.ontrack=null}try{b===S.Connected&&await y(h,k).catch(C=>{})}catch(C){O("Error on close stream connection",C)}(g=o.onVideoStateChange)==null||g.call(o,N.Stop),clearInterval(u)}},sessionId:k,streamId:h}}let G={};function Ie(e){const t=window!=null&&window.hasOwnProperty("DID_AGENTS_API")?"agents-ui":"agents-sdk",s={token:e.token||"testKey",distinct_id:e.distinctId||ce(),agentId:e.agent.id,agentType:e.agent.presenter.type,owner_id:e.agent.owner_id??""};return{...s,isEnabled:e.isEnabled??!0,getRandom:()=>Math.random().toString(16).slice(2),track(o,r){if(!this.isEnabled)return Promise.reject("MixPanel analytics is disabled on creation");const{audioPath:a,...i}=r||{},n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({data:JSON.stringify([{event:o,properties:{...i,...s,source:t,time:Date.now(),$insert_id:this.getRandom(),origin:window.location.href,"Screen Height":window.screen.height||window.innerWidth,"Screen Width":window.screen.width||window.innerHeight,"User Agent":navigator.userAgent}}])})};return fetch("https://api-js.mixpanel.com/track/?verbose=1&ip=1",n).then(d=>d.json()).catch(d=>console.error(d))},linkTrack(o,r,a,i){G[o]||(G[o]={events:{},resolvedDependencies:[]}),i.includes(a)||i.push(a);const n=G[o];if(n.events[a]={props:r},n.resolvedDependencies.push(a),i.every(d=>n.resolvedDependencies.includes(d))){const d=i.reduce((w,y)=>n.events[y]?{...w,...n.events[y].props}:w,{});this.track(o,d),n.resolvedDependencies=n.resolvedDependencies.filter(w=>!i.includes(w)),i.forEach(w=>{delete n.events[w]})}}}}function Oe(e){var t,s,o,r,a;const i=()=>/Mobi|Android/i.test(navigator.userAgent)?"Mobile":"Desktop";return{$os:`${(()=>{const n=navigator.platform;return n.toLowerCase().includes("win")?"Windows":n.toLowerCase().includes("mac")?"Mac OS X":n.toLowerCase().includes("linux")?"Linux":"Unknown"})()}`,isMobile:`${i()=="Mobile"}`,browser:navigator.userAgent,origin:window.location.origin,agentType:(t=e.presenter)==null?void 0:t.type,agentVoice:{voiceId:(o=(s=e.presenter)==null?void 0:s.voice)==null?void 0:o.voice_id,provider:(a=(r=e.presenter)==null?void 0:r.voice)==null?void 0:a.type}}}function Le(e,t,s){var o,r;const{event:a,...i}=e,{template:n}=(t==null?void 0:t.llm)||{},{language:d}=((o=t==null?void 0:t.presenter)==null?void 0:o.voice)||{},{stitch:w}=(t==null?void 0:t.presenter)||{};return{...i,llm:{...i.llm,template:n},script:{...i.script,provider:{...(r=i==null?void 0:i.script)==null?void 0:r.provider,language:d}},stitch:w,...s}}let R=0;function Pe(e,t){var s,o,r,a,i,n,d;return e.presenter.type===B.Clip?{videoType:B.Clip,session_timeout:(s=t==null?void 0:t.streamOptions)==null?void 0:s.sessionTimeout,stream_warmup:(o=t==null?void 0:t.streamOptions)==null?void 0:o.streamWarmup,compatibility_mode:(r=t==null?void 0:t.streamOptions)==null?void 0:r.compatibilityMode}:{videoType:B.Talk,session_timeout:(a=t==null?void 0:t.streamOptions)==null?void 0:a.sessionTimeout,stream_warmup:(i=t==null?void 0:t.streamOptions)==null?void 0:i.streamWarmup,compatibility_mode:(n=t==null?void 0:t.streamOptions)==null?void 0:n.compatibilityMode,output_resolution:(d=t==null?void 0:t.streamOptions)==null?void 0:d.outputResolution}}function ue(e){return e===_.Playground?{headers:{[Me]:"true"}}:{}}async function ge(e,t,s,o){try{const r=await t.newChat(e,ue(o));return s.track("agent-chat",{event:"created",chat_id:r.id,agent_id:e,mode:o}),r}catch(r){try{console.error(r);const a=JSON.parse(r.message);if((a==null?void 0:a.kind)==="InsufficientCreditsError")throw new Error("InsufficientCreditsError")}catch(a){console.error("Error parsing the error message:",a)}throw new Error("Cannot create new chat")}}function De(e,t,s,o,r){return new Promise(async(a,i)=>{var n;R=0;const d=await Te(e.id,Pe(e,t),{...t,analytics:o,warmup:(n=t.streamOptions)==null?void 0:n.streamWarmup,callbacks:{...t.callbacks,onConnectionStateChange:async w=>{var y,v;w===S.Connected&&(!r&&t.mode!==_.DirectPlayback&&(r=await ge(e.id,s,o,t.mode).catch(m=>{i(m)})),d?a({chat:r,streamingManager:d}):r&&i(new Error("Something went wrong while initializing the manager"))),(v=(y=t.callbacks).onConnectionStateChange)==null||v.call(y,w)},onVideoStateChange(w){var y,v;(v=(y=t.callbacks).onVideoStateChange)==null||v.call(y,w),R>0&&w===N.Start&&o.linkTrack("agent-video",{event:"start",latency:Date.now()-R},"start",[X.StreamVideoCreated])}}}).catch(i)})}function oe(e){let t="";if(e.greetings&&e.greetings.length>0){const s=Math.floor(Math.random()*e.greetings.length);t=e.greetings[s]}else t=`Hi! I'm ${e.preview_name||"My Agent"}. How can I help you?`;return[{content:t,id:U(),role:"assistant",created_at:new Date().toISOString()}]}function Ae(e){if(e.answer!==void 0)return e.answer;let t=0,s="";for(;t in e;)s+=e[t],t++;return s}function Re(e,t,s,o,r){if(!(e===x.Partial||e===x.Answer))return;const a=o.messages[o.messages.length-1];if((a==null?void 0:a.role)!=="assistant")return;const{content:i,sequence:n}=t;e===x.Partial?s[n]=i:s.answer=i;const d=Ae(s);(a.content!==d||e===x.Answer)&&(a.content=d,r==null||r([...o.messages],e))}async function xe(e,t){var s,o,r;let a={},i=!0;const n={messages:[],chatMode:t.mode||_.Functional},d=t.baseURL||Q,w=t.wsURL||he,y=t.mixpanelKey||pe,v=ve(t.auth,d,t.callbacks.onError),m=await v.getById(e);n.messages=oe(m),(o=(s=t.callbacks).onNewMessage)==null||o.call(s,[...n.messages],"answer");const h=Ie({token:y,agent:m,...t});h.track("agent-sdk",{event:"loaded",...Oe(m)});const Z={onMessage:(c,u)=>{var p,l;if("content"in u)Re(c,u,a,n,t.callbacks.onNewMessage),c===x.Answer&&h.track("agent-message-received",{messages:n.messages.length,mode:n.chatMode});else{const g=X,b=[g.StreamVideoDone,g.StreamVideoError,g.StreamVideoRejected],C=[g.StreamFailed,g.StreamVideoError,g.StreamVideoRejected],E=Le(u,m,{mode:n.chatMode});if(c=c,c===g.StreamVideoCreated)h.linkTrack("agent-video",E,g.StreamVideoCreated,["start"]);else if(b.includes(c)){const M=c.split("/")[1];h.track("agent-video",{...E,event:M})}C.includes(c)&&((l=(p=t.callbacks).onError)==null||l.call(p,new Error(`Stream failed with event ${c}`),{data:u})),u.event===g.StreamDone&&k()}}};async function j(c){var u,p,l,g,b;R=0,c&&!i&&(delete n.chat,n.messages=oe(m),(p=(u=t.callbacks).onNewMessage)==null||p.call(u,[...n.messages],"answer"));const C=t.mode===_.DirectPlayback?Promise.resolve(void 0):Se(t.auth,w,Z),E=De(m,t,v,h,n.chat).catch(D=>{throw f(_.Maintenance),D}),[M,{streamingManager:I,chat:T}]=await Promise.all([C,E]);T&&T.id!==((l=n.chat)==null?void 0:l.id)&&((b=(g=t.callbacks).onNewChat)==null||b.call(g,T.id)),n.streamingManager=I,n.socketManager=M,n.chat=T,i=!1,f((T==null?void 0:T.chat_mode)??t.mode??_.Functional)}async function k(){var c,u,p,l;(c=n.socketManager)==null||c.disconnect(),await((u=n.streamingManager)==null?void 0:u.disconnect()),delete n.streamingManager,delete n.socketManager,(l=(p=t.callbacks).onConnectionStateChange)==null||l.call(p,S.Disconnected)}async function f(c){var u,p;c!==n.chatMode&&(h.track("agent-mode-change",{mode:c}),n.chatMode=c,n.chatMode!==_.Functional&&await k(),(p=(u=t.callbacks).onModeChange)==null||p.call(u,c))}return{agent:m,starterMessages:((r=m.knowledge)==null?void 0:r.starter_message)||[],changeMode:f,async connect(){var c;await j(!0),h.track("agent-chat",{event:"connect",chatId:(c=n.chat)==null?void 0:c.id,agentId:m.id,mode:n.chatMode})},async reconnect(){var c;await k(),await j(!1),h.track("agent-chat",{event:"reconnect",chatId:(c=n.chat)==null?void 0:c.id,agentId:m.id,mode:n.chatMode})},async disconnect(){var c;await k(),h.track("agent-chat",{event:"disconnect",chatId:(c=n.chat)==null?void 0:c.id,agentId:m.id,mode:n.chatMode})},async chat(c){var u,p,l,g,b,C;const E=U();a={};try{if(R=Date.now(),t.mode===_.DirectPlayback)throw new Error("Direct playback is enabled, chat is disabled");if(c.length>=800)throw new Error("Message cannot be more than 800 characters");if(c.length===0)throw new Error("Message cannot be empty");if(n.chatMode===_.Maintenance)throw new Error("Chat is in maintenance mode");if(![_.TextOnly,_.Playground].includes(n.chatMode))if(n.streamingManager){if(!n.chat)throw new Error("Chat is not initialized")}else throw new Error("Streaming manager is not initialized");n.messages.push({id:U(),role:"user",content:c,created_at:new Date(R).toISOString()}),(p=(u=t.callbacks).onNewMessage)==null||p.call(u,[...n.messages],"user"),n.chat||(n.chat=await ge(m.id,v,h,n.chatMode),(g=(l=t.callbacks).onNewChat)==null||g.call(l,n.chat.id));const M={id:E,role:"assistant",content:"",created_at:new Date().toISOString(),matches:[]},I=[...n.messages];n.messages.push(M);const T=q=>{var K,ae;return v.chat(m.id,q,{sessionId:(K=n.streamingManager)==null?void 0:K.sessionId,streamId:(ae=n.streamingManager)==null?void 0:ae.streamId,chatMode:n.chatMode,messages:I},ue(n.chatMode))},D=await T(n.chat.id).catch(async q=>{var K;if(!((K=q==null?void 0:q.message)!=null&&K.includes("missing or invalid session_id")))throw q;return await k(),await j(!1),T(n.chat.id)});return h.track("agent-message-send",{event:"success",mode:n.chatMode,messages:n.messages.length+1}),M.context=D.context,M.matches=D.matches,D.result&&(M.content=D.result,h.track("agent-message-received",{latency:Date.now()-R,mode:n.chatMode,messages:n.messages.length}),(C=(b=t.callbacks).onNewMessage)==null||C.call(b,[...n.messages],"answer")),D}catch(M){throw n.messages[n.messages.length-1].id===E&&n.messages.pop(),h.track("agent-message-send",{event:"error",mode:n.chatMode,messages:n.messages.length}),M}},rate(c,u,p){var l,g,b,C;const E=n.messages.find(I=>I.id===c);if(n.chat){if(!E)throw new Error("Message not found")}else throw new Error("Chat is not initialized");const M=((l=E.matches)==null?void 0:l.map(I=>[I.document_id,I.id]))??[];return h.track("agent-rate",{event:p?"update":"create",thumb:u===1?"up":"down",knowledge_id:((g=m.knowledge)==null?void 0:g.id)??"",mode:n.chatMode,matches:M,score:u}),p?v.updateRating(m.id,n.chat.id,p,{knowledge_id:((b=m.knowledge)==null?void 0:b.id)??"",message_id:c,matches:M,score:u}):v.createRating(m.id,n.chat.id,{knowledge_id:((C=m.knowledge)==null?void 0:C.id)??"",message_id:c,matches:M,score:u})},deleteRate(c){var u;if(!n.chat)throw new Error("Chat is not initialized");return h.track("agent-rate-delete",{type:"text",chat_id:(u=n.chat)==null?void 0:u.id,id:c,mode:n.chatMode}),v.deleteRating(m.id,n.chat.id,c)},speak(c){if(!n.streamingManager)throw new Error("Please connect to the agent first");function u(){if(typeof c=="string"){if(!m.presenter.voice)throw new Error("Presenter voice is not initialized");return{type:"text",provider:m.presenter.voice,input:c,ssml:!1}}if(c.type==="text"&&!c.provider){if(!m.presenter.voice)throw new Error("Presenter voice is not initialized");return{type:"text",provider:m.presenter.voice,input:c.input,ssml:c.ssml}}return c}const p=u();return h.track("agent-speak",p),n.streamingManager.speak({script:p})}}}let Ne="agt_twx-LK32",me={type:"key",clientKey:"Z29vZ2xlLW9hdXRoMnwxMDI5MDQ4NjI1NzIzMzU1MjQyOTM6WEFnN2Z5SUVPN3dTeU5yREEyVXg3"},A=document.querySelector("#videoElement"),F=document.querySelector("#textArea"),z=document.querySelector("#langSelect"),P=document.querySelector("#speechButton"),W=document.querySelector("#answers"),L=document.querySelector("#connectionLabel"),V=document.getElementById("chatButton"),H=document.getElementById("speakButton"),Ve=document.querySelector("#reconnectButton"),Y,$;const He={onSrcObjectReady(e){return console.log("onSrcObjectReady():",e),A.srcObject=e,Y=e,Y},onConnectionStateChange(e){console.log("onConnectionStateChange(): ",e),e=="connecting"?(L.innerHTML="Connecting..",document.querySelector("#container").style.display="flex",document.querySelector("#hidden").style.display="none"):e=="connected"?(F.addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),J())}),V.removeAttribute("disabled"),H.removeAttribute("disabled"),z.removeAttribute("disabled"),P.removeAttribute("disabled"),L.innerHTML="Online"):(e=="disconnected"||e=="closed")&&(F.removeEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),J())}),document.querySelector("#hidden_h2").innerHTML=`${$.agent.preview_name} Disconnected`,document.querySelector("#hidden").style.display="block",document.querySelector("#container").style.display="none",V.setAttribute("disabled",!0),H.setAttribute("disabled",!0),z.setAttribute("disabled",!0),P.setAttribute("disabled",!0),L.innerHTML="")},onVideoStateChange(e){console.log("onVideoStateChange(): ",e),e=="STOP"?(A.muted=!0,A.srcObject=void 0,A.src=$.agent.presenter.idle_video):(A.muted=!1,A.src="",A.srcObject=Y,L.innerHTML="Online")},onNewMessage(e,t){console.log("onNewMessage():",e,t);let s=e.length-1,o=e[s];o.role=="assistant"&&e.length!=1?t=="answer"&&(W.innerHTML+=`${se()} - [${o.role}] : ${o.content}  <button id='${o.id}_plus' title='agentManager.rate() -> Rate this answer (+)'>+</button> <button id='${o.id}_minus' title='agentManager.rate() -> Rate this answer (-)'>-</button> <br>`,document.getElementById(`${o.id}_plus`).addEventListener("click",()=>ie(o.id,1)),document.getElementById(`${o.id}_minus`).addEventListener("click",()=>ie(o.id,-1))):W.innerHTML+=`${se()} - [${o.role}] : ${o.content}  <br>`,W.scrollTop=W.scrollHeight},onError(e,t){L.innerHTML='<span style="color:red">Something went wrong :(</span>',console.log("Error:",e,"Error Data",t)}};let je={compatibilityMode:"auto",streamWarmup:!0};function qe(){let e=F.value;e!==""&&e.length>2&&($.speak({type:"text",input:e}),console.log(`agentManager.speak("${e}")`),L.innerHTML="Streaming..")}function J(e=""){e!==""&&($.chat(e),console.log("agentManager.chat()"),L.innerHTML="Thinking..")}function ie(e,t){let s=$.rate(e,t);console.log(`Message ID: ${e} Rated:${t}
`,"Result",s)}function Ke(){console.log("clicked");let e=$.reconnect();console.log("agentManager.reconnect()",e)}function se(){const e=new Date,t=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),o=e.getSeconds().toString().padStart(2,"0");return`${t}:${s}:${o}`}me.clientKey==""&&(L.innerHTML="<span style='color:red; font-weight:bold'> Missing agentID and auth.clientKey variables</span>",console.error("Missing agentID and auth.clientKey variables"),console.log(`Missing agentID and auth.clientKey variables:

Fetch the data-client-key and the data-agent-id as explained on the Agents SDK Overview Page:
https://docs.d-id.com/reference/agents-sdk-overview

Paste these into their respective variables at the top of the main.js file and save.`));V.addEventListener("click",()=>J());H.addEventListener("click",()=>qe());Ve.addEventListener("click",()=>Ke());P.addEventListener("click",()=>ze());window.addEventListener("load",()=>{F.focus(),V.setAttribute("disabled",!0),H.setAttribute("disabled",!0),z.setAttribute("disabled",!0),P.setAttribute("disabled",!0)});const Be=()=>new Promise((e,t)=>{try{let s=xe(Ne,{auth:me,callbacks:He,streamOptions:je});return e(s)}catch(s){t(s)}}),Fe=async()=>{$=await Be(),console.log("sdk.createAgentManager()",$),document.querySelector("#previewName").innerHTML=$.agent.preview_name,console.log("agentManager.connect()"),$.connect()};Fe();var ee;navigator.userAgent.includes("Firefox")?recognition=new SpeechRecognition:recognition=new webkitSpeechRecognition;recognition.lang=z.value;recognition.continuous=!0;ne();recognition.onend=ne;recognition.onresult=function(e){console.log(e);for(var t=e.resultIndex;t<e.results.length;++t)e.results[t].isFinal&&(console.log("Texto reconocido:",e.results[t][0].transcript),J(e.results[t][0].transcript))};function ne(){ee=!1,P.style.color="black",P.innerHTML='<span class="material-symbols-outlined">mic</span>',V.removeAttribute("disabled"),H.removeAttribute("disabled")}function ze(){recognition.lang=z.value,ee?(F.focus(),recognition.stop(),ne()):(recognition.start(),ee=!0,P.style.color="red",P.innerHTML="&#x23F9;",V.setAttribute("disabled",!0),H.setAttribute("disabled",!0))}
